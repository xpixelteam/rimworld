<?xml version="1.0" encoding="utf-8" ?>
<Defs>
 <!-- 盾构机矿山 -->
  
  <!-- 自然刷新 -->
  <QuestScriptDef>
    <defName>AncientShieldMiningSite</defName>
    <autoAccept>true</autoAccept>
    <rootSelectionWeight>1.0</rootSelectionWeight>
    <defaultChallengeRating>1</defaultChallengeRating>
    <rootMinPoints>7000</rootMinPoints>
    <questNameRules>
      <rulesStrings>
        <li>questName->Ancient Shield Mining Site</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->Rumors have been circulating about a collapsed ancient mine that looks worthless on the outside, but has recently been saying that its interior is not completely collapsed and contains vast resources.\n\nMaybe we can find out if this myth is true.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_ViolentQuestsAllowed">
          <node Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>1</value>
          </node>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>AncientShieldMiningSite</tag>
            </li>
            <li>
              <tag>MineralScannerPreciousLumpThreat</tag>
              <chance>$siteThreatChance</chance>
            </li>
          </sitePartsTags>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>


        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End" />
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

  <!-- 扫描 -->
  <QuestScriptDef>
    <defName>Scan_AncientShieldMiningSite</defName>
    <autoAccept>true</autoAccept>
    <defaultChallengeRating>1</defaultChallengeRating>
    <isRootSpecial>true</isRootSpecial>
    <rootMinPoints>7000</rootMinPoints>
    <questNameRules>
      <rulesStrings>
        <li>questName->Ancient Shield Mining Site</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->[worker_definite] followed the scanner's instructions to find a collapsed mine hole nearby,Others might overlook a collapsed mine, but its internal structure remains intact, and there are abundant minerals accessible with tunnel boring machines.  If we can reach it, these resources will be ours.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_ViolentQuestsAllowed">
          <node Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>1</value>
          </node>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>AncientShieldMiningSite</tag>
            </li>
            <li>
              <tag>MineralScannerPreciousLumpThreat</tag>
              <chance>$siteThreatChance</chance>
            </li>
          </sitePartsTags>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End" />
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

 <!-- 隧道施工遗址 -->

  <!-- 自然刷新 -->
  <QuestScriptDef>
    <defName>AncientTunnelRuins</defName>
    <autoAccept>true</autoAccept>
    <rootSelectionWeight>1</rootSelectionWeight>
    <defaultChallengeRating>1</defaultChallengeRating>
    <rootMinPoints>7000</rootMinPoints>
    <questNameRules>
      <rulesStrings>
        <li>questName->Ancient Tunnel Ruins</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->The scanner reveals the presence of an undiscovered, incomplete tunnel construction site. Facilities at that location have been damaged; however, we can still recover a large amount of raw materials and components from it.\n\nThere were still quite a few automatic turrets in the construction area, and we weren't sure if their Identification Friend or Foe system would recognize us as the enemy.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_ViolentQuestsAllowed">
          <node Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>1</value>
          </node>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>AncientTunnelRuins</tag>
            </li>
            <li>
              <tag>MineralScannerPreciousLumpThreat</tag>
              <chance>$siteThreatChance</chance>
            </li>
          </sitePartsTags>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End" />
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

  <!-- 扫描 -->
  <QuestScriptDef>
    <defName>Scan_AncientTunnelRuins</defName>
    <autoAccept>true</autoAccept>
    <defaultChallengeRating>1</defaultChallengeRating>
    <isRootSpecial>true</isRootSpecial>
    <rootMinPoints>7000</rootMinPoints>
    <questNameRules>
      <rulesStrings>
        <li>questName->Ancient Tunnel Ruins</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->The scanner revealed an undiscovered Ancient Tunnel Ruins nearby, with varying degrees of damage to its facilities, but a significant amount of raw materials and parts being recovered.The automatic defense system in the construction area is still operating, so we need to be careful.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_ViolentQuestsAllowed">
          <node Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>1</value>
          </node>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>AncientTunnelRuins</tag>
            </li>
            <li>
              <tag>MineralScannerPreciousLumpThreat</tag>
              <chance>$siteThreatChance</chance>
            </li>
          </sitePartsTags>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End" />
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

 <!-- 挖掘机矿场 -->

  <!-- 自然刷新 -->
  <QuestScriptDef>
    <defName>AncientOpenPitMiningSite</defName>
    <autoAccept>true</autoAccept>
    <rootMinPoints>10000</rootMinPoints>
    <defaultChallengeRating>1</defaultChallengeRating>
    <rootSelectionWeight>1.0</rootSelectionWeight>
    <questNameRules>
      <rulesStrings>
        <li>questName->Ancient Open Pit MiningSite</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->There is news that there is an ancient open-pit mine near us, and the important thing in its interior is that the giant excavator has collapsed, although it is no longer usable, but its advanced parts are not damaged.\n\nThis may be a trap, but it may also be an opportunity.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_ViolentQuestsAllowed">
          <node Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>1</value>
          </node>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>AncientOpenPitMiningSite</tag>
            </li>
            <li>
              <tag>MineralScannerPreciousLumpThreat</tag>
              <chance>$siteThreatChance</chance>
            </li>
          </sitePartsTags>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End" />
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

  <!-- 扫描 -->
  <QuestScriptDef>
    <defName>Scan_AncientOpenPitMiningSite</defName>
    <autoAccept>true</autoAccept>
    <rootMinPoints>10000</rootMinPoints>
    <defaultChallengeRating>1</defaultChallengeRating>
    <isRootSpecial>true</isRootSpecial>
    <questNameRules>
      <rulesStrings>
        <li>questName->Ancient Open Pit MiningSite</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->[worker_definite] have discovered an ancient open-pit mine nearby. Despite the collapse of the giant excavators due to years of disrepair, we should still be able to recover a substantial amount of resources and even salvage some advanced components. The damage to other structures is not as severe, and there might be a small amount of resources in these buildings as well. </li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_ViolentQuestsAllowed">
          <node Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>1</value>
          </node>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>AncientOpenPitMiningSite</tag>
            </li>
            <li>
              <tag>MineralScannerPreciousLumpThreat</tag>
              <chance>$siteThreatChance</chance>
            </li>
          </sitePartsTags>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End" />
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

 <!-- 铁矿场 -->

  <!-- 自然刷新 -->
  <QuestScriptDef>
    <defName>AbandonedSteelMineSite</defName>
    <rootSelectionWeight>0.5</rootSelectionWeight>
    <rootMinPoints>7000</rootMinPoints>
    <autoAccept>true</autoAccept>
    <defaultChallengeRating>3</defaultChallengeRating>
    <questNameRules>
      <rulesStrings>
        <li>questName->Abandoned Steel Mining Site</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>      
        <li>questDescription->[asker_faction_name] tells us that [siteFaction_name] appears frequently near [map_definite] recently, By tracking them down and finding out that they're digging a hole in an ancient iron mine that collapsed, we might be able to wipe out the defenders and take the mine for ourselves, but why would they put so much effort into a collapsed iron mine?\n\nIt's not going to be easy to dig the hole open, we still have plenty of time.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>
        <li Class="QuestNode_GetMap" />

        <li Class="QuestNode_GetPawn">
          <storeAs>asker</storeAs>
          <mustBeFactionLeader>true</mustBeFactionLeader>
          <allowPermanentEnemyFaction>false</allowPermanentEnemyFaction>
          <hostileWeight>0</hostileWeight>
        </li>

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li><tag>AbandonedSteelMineSite</tag></li>
            <li><tag>Soldier_S</tag></li>
          </sitePartsTags>
          <mustBeHostileToFactionOf>$asker</mustBeHostileToFactionOf>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <isQuestTimeout>true</isQuestTimeout>
          <delayTicks>$(randInt(90,120)*60000)</delayTicks>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label>Quest expired: [resolvedQuestName]</label>
                <text>The minerals in the mine have been completely mined, and only useless stones remain.The quest [resolvedQuestName] has ended.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_Signal">
          <inSignal>site.Destroyed</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label TKey="LetterLabelQuestFailed">Quest failed: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestFailed">They fortified their defenses after our retreat, making it impossible for us to plan another attack. The quest [resolvedQuestName] has ended.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_Signal">
          <inSignal>site.AllEnemiesDefeated</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Notify_PlayerRaidedSomeone">
                <getRaidersFromMapParent>$site</getRaidersFromMapParent>
              </li>
            </nodes>
          </node>
        </li>
        <li Class="QuestNode_End">
          <inSignal>site.AllEnemiesDefeated</inSignal>
          <outcome>Success</outcome>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

  <!-- 扫描 -->
  <QuestScriptDef>
    <defName>Scan_AbandonedSteelMineSite</defName>
    <rootMinPoints>7000</rootMinPoints>
    <autoAccept>true</autoAccept>
    <isRootSpecial>true</isRootSpecial>
    <defaultChallengeRating>3</defaultChallengeRating>
    <questNameRules>
      <rulesStrings>
        <li>questName->Abandoned Steel Mining Site</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->We found an old steel mine whose entrance had collapsed, and the scanners told us that there was a lot of unmined steel inside the mine and a lot of broken equipment from which we could recover a lot of resources. But we are not the first to discover this steel mine, other forces are already on the move, the cave collapse may take a long time, they may be targeting more than just the mineral deposits inside.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>
        <li Class="QuestNode_GetMap" />

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li><tag>AbandonedSteelMineSite</tag></li>
            <li><tag>Soldier_S</tag></li>
          </sitePartsTags>
        </li>

		<li Class="VFECore.QuestNode_GetFaction">
			<allowEnemy>true</allowEnemy>
			<mustBePermanentEnemy>true</mustBePermanentEnemy>
			<storeAs>siteFaction</storeAs>
			<factionDef>Pirate</factionDef>
		</li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <isQuestTimeout>true</isQuestTimeout>
          <delayTicks>$(randInt(90,120)*60000)</delayTicks>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label>Quest expired: [resolvedQuestName]</label>
                <text>The minerals in the mine have been completely mined, and only useless stones remain.The quest [resolvedQuestName] has ended.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_Signal">
          <inSignal>site.Destroyed</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label TKey="LetterLabelQuestFailed">Quest failed: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestFailed">They fortified their defenses after our retreat, making it impossible for us to plan another attack. The quest [resolvedQuestName] has ended.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_Signal">
          <inSignal>site.AllEnemiesDefeated</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Notify_PlayerRaidedSomeone">
                <getRaidersFromMapParent>$site</getRaidersFromMapParent>
              </li>
            </nodes>
          </node>
        </li>
        <li Class="QuestNode_End">
          <inSignal>site.AllEnemiesDefeated</inSignal>
          <outcome>Success</outcome>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

 <!-- 玻璃钢矿场 -->
  
  <!-- 自然刷新 -->
  <QuestScriptDef>
    <defName>AbandonedPlasteelMineSite</defName>
    <rootMinPoints>7000</rootMinPoints>
    <rootSelectionWeight>0.5</rootSelectionWeight>
    <autoAccept>true</autoAccept>
    <defaultChallengeRating>4</defaultChallengeRating>
    <questNameRules>
      <rulesStrings>
        <li>questName->Abandoned Plasteel Mining Site</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>      
        <li>questDescription->We know from the information given by [asker_faction_name] that [siteFaction_name] got into the plasteel mine by other means, and the entrance to the mine collapsed for other reasons and they built a temporary base inside. We had no information on other routes into the mine, and if we were to seize the mine we would have to dig open the cave that had collapsed and destroy the garrison stationed at the temporary base. After some time, an expedition will be sent to bring in the spoils, and until then the defenders will be left alone to face all threats, including ours.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>
        <li Class="QuestNode_GetMap" />

        <li Class="QuestNode_GetPawn">
          <storeAs>asker</storeAs>
          <mustBeFactionLeader>true</mustBeFactionLeader>
          <allowPermanentEnemyFaction>false</allowPermanentEnemyFaction>
          <hostileWeight>0</hostileWeight>
        </li>

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li><tag>AbandonedPlasteelMineSite</tag></li>
            <li><tag>Soldier_M</tag></li>
          </sitePartsTags>
          <mustBeHostileToFactionOf>$asker</mustBeHostileToFactionOf>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <isQuestTimeout>true</isQuestTimeout>
          <delayTicks>$(randInt(90,120)*60000)</delayTicks>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label>Quest expired: [resolvedQuestName]</label>
                <text>The minerals in the mine have been completely mined, and only useless stones remain.The quest [resolvedQuestName] has ended.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_Signal">
          <inSignal>site.Destroyed</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label TKey="LetterLabelQuestFailed">Quest failed: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestFailed">They fortified their defenses after our retreat, making it impossible for us to plan another attack. The quest [resolvedQuestName] has ended.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_Signal">
          <inSignal>site.AllEnemiesDefeated</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Notify_PlayerRaidedSomeone">
                <getRaidersFromMapParent>$site</getRaidersFromMapParent>
              </li>
            </nodes>
          </node>
        </li>
        <li Class="QuestNode_End">
          <inSignal>site.AllEnemiesDefeated</inSignal>
          <outcome>Success</outcome>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

  <!-- 扫描 -->
  <QuestScriptDef>
    <defName>Scan_AbandonedPlasteelMineSite</defName>
    <rootMinPoints>7000</rootMinPoints>
    <autoAccept>true</autoAccept>
	<isRootSpecial>true</isRootSpecial>
    <defaultChallengeRating>3</defaultChallengeRating>
    <questNameRules>
      <rulesStrings>
        <li>questName->Abandoned Plasteel Mining Site</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->The scanners tell us that there is an ancient plasteel mine nearby.  Although the entrance has collapsed, the scanners show that there is still a lot of life inside. If we are going to go there, we'd better take our weapons with us.\n\nSuch a large plasteel deposit is bound to attract the attention of other powers, but most of them take a long time to assemble a mining team, and we can do it faster than them.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>
        <li Class="QuestNode_GetMap" />

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li><tag>AbandonedPlasteelMineSite</tag></li>
            <li><tag>Soldier_M</tag></li>
          </sitePartsTags>
        </li>

		<li Class="VFECore.QuestNode_GetFaction">
			<allowEnemy>true</allowEnemy>
			<mustBePermanentEnemy>true</mustBePermanentEnemy>
			<storeAs>siteFaction</storeAs>
			<factionDef>Pirate</factionDef>
		</li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <isQuestTimeout>true</isQuestTimeout>
          <delayTicks>$(randInt(90,120)*60000)</delayTicks>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label>Quest expired: [resolvedQuestName]</label>
                <text>The minerals in the mine have been completely mined, and only useless stones remain.The quest [resolvedQuestName] has ended.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_Signal">
          <inSignal>site.Destroyed</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label TKey="LetterLabelQuestFailed">Quest failed: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestFailed">They fortified their defenses after our retreat, making it impossible for us to plan another attack. The quest [resolvedQuestName] has ended.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_Signal">
          <inSignal>site.AllEnemiesDefeated</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Notify_PlayerRaidedSomeone">
                <getRaidersFromMapParent>$site</getRaidersFromMapParent>
              </li>
            </nodes>
          </node>
        </li>
        <li Class="QuestNode_End">
          <inSignal>site.AllEnemiesDefeated</inSignal>
          <outcome>Success</outcome>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

 <!-- 铀矿场 (问题：敌方迫击炮打完一发后不会再继续开火) -->

  <!-- 自然刷新 -->
  <QuestScriptDef>
    <defName>AbandonedUraniumMiningSite</defName>
    <rootSelectionWeight>0.5</rootSelectionWeight>
    <rootMinPoints>10000</rootMinPoints>
    <autoAccept>true</autoAccept>
    <defaultChallengeRating>4</defaultChallengeRating>
    <questNameRules>
      <rulesStrings>
        <li>questName->Abandoned Uranium MiningSite</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>      
        <li>questDescription->[asker_faction_name] tells us that [siteFaction_name] is occupying an ancient military uranium mine nearby that they have occupied, and we can be sure that the original defense system of the site has identified them as the new owners, and if we need the uranium mine, Then we need to take out both the garrison and the defense system.\n\n[siteFaction_name] is mining the mine, [asker_faction_name] has given us some time to deal with them, if we don't deal with them, they will take over.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>
        <li Class="QuestNode_GetMap" />

        <li Class="QuestNode_GetPawn">
          <storeAs>asker</storeAs>
          <mustBeFactionLeader>true</mustBeFactionLeader>
          <allowPermanentEnemyFaction>false</allowPermanentEnemyFaction>
          <hostileWeight>0</hostileWeight>
        </li>

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>AbandonedUraniumMiningSite</tag>
            </li>
            <li>
              <tag>Soldier_M</tag>
            </li>
          </sitePartsTags>
          <mustBeHostileToFactionOf>$asker</mustBeHostileToFactionOf>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <isQuestTimeout>true</isQuestTimeout>
          <delayTicks>$(randInt(90,120)*60000)</delayTicks>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label>Quest expired: [resolvedQuestName]</label>
                <text>The minerals in the mine have been completely mined, and only useless stones remain.The quest [resolvedQuestName] has ended.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_Signal">
          <inSignal>site.Destroyed</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label TKey="LetterLabelQuestFailed">Quest failed: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestFailed">They fortified their defenses after our retreat, making it impossible for us to plan another attack. The quest [resolvedQuestName] has ended.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_Signal">
          <inSignal>site.AllEnemiesDefeated</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Notify_PlayerRaidedSomeone">
                <getRaidersFromMapParent>$site</getRaidersFromMapParent>
              </li>
            </nodes>
          </node>
        </li>
        <li Class="QuestNode_End">
          <inSignal>site.AllEnemiesDefeated</inSignal>
          <outcome>Success</outcome>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

  <!-- 扫描 -->
  <QuestScriptDef>
    <defName>Scan_AbandonedUraniumMiningSite</defName>
    <rootMinPoints>10000</rootMinPoints>
    <autoAccept>true</autoAccept>
	<isRootSpecial>true</isRootSpecial>
    <defaultChallengeRating>4</defaultChallengeRating>
    <questNameRules>
      <rulesStrings>
        <li>questName->Abandoned Uranium Mining Site</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->[worker_definite] successfully found an ancient military uranium mine on the scanner, but we are not the first to find this uranium mine, someone has occupied this uranium mine ahead of us, the original defense system identified them as the new master, we now not only have to face the defenders of the site, but also have to find a way to solve the defense facilities.\n\nThe defenders are now exploiting the remaining uranium in the mine. There is still some time before it is fully mined. We must be well prepared before we move.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>
        <li Class="QuestNode_GetMap" />

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li><tag>AbandonedUraniumMiningSite</tag></li>
            <li><tag>Soldier_M</tag></li>
          </sitePartsTags>
        </li>

		<li Class="VFECore.QuestNode_GetFaction">
			<allowEnemy>true</allowEnemy>
			<mustBePermanentEnemy>true</mustBePermanentEnemy>
			<storeAs>siteFaction</storeAs>
			<factionDef>Pirate</factionDef>
		</li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <isQuestTimeout>true</isQuestTimeout>
          <delayTicks>$(randInt(90,120)*60000)</delayTicks>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label>Quest expired: [resolvedQuestName]</label>
                <text>The minerals in the mine have been completely mined, and only useless stones remain.The quest [resolvedQuestName] has ended.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_Signal">
          <inSignal>site.Destroyed</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label TKey="LetterLabelQuestFailed">Quest failed: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestFailed">They fortified their defenses after our retreat, making it impossible for us to plan another attack. The quest [resolvedQuestName] has ended.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_Signal">
          <inSignal>site.AllEnemiesDefeated</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Notify_PlayerRaidedSomeone">
                <getRaidersFromMapParent>$site</getRaidersFromMapParent>
              </li>
            </nodes>
          </node>
        </li>
        <li Class="QuestNode_End">
          <inSignal>site.AllEnemiesDefeated</inSignal>
          <outcome>Success</outcome>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

 <!-- 废弃筛矿站 -->
 
  <!-- 自然刷新 -->
  <QuestScriptDef>
    <defName>MineralScreeningStation</defName>
    <rootSelectionWeight>2.0</rootSelectionWeight>
    <defaultChallengeRating>1</defaultChallengeRating>
    <rootMinPoints>0</rootMinPoints>
    <autoAccept>true</autoAccept>
    <questNameRules>
      <rulesStrings>
        <li>questName->Mineral Screening Station</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->[asker_faction_name] informed us about an mineral screening station near [map_definite]. Despite the main building being destroyed, the automatic defense system remains operational, and we won't be treated as hostile for unknown reasons.   This implies we can recover most of the resources without hindrance.\n\nIf we choose not to proceed with recycling, [asker_faction_name] will gather these ancient riches instead.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_GetDefaultRewardValueFromPoints</def>
        </li>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>
        <li Class="QuestNode_GetMap" />

        <li Class="QuestNode_GetPawn">
          <storeAs>asker</storeAs>
          <mustBeFactionLeader>true</mustBeFactionLeader>
          <allowPermanentEnemyFaction>false</allowPermanentEnemyFaction>
          <hostileWeight>0</hostileWeight>
        </li>

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_ViolentQuestsAllowed">
          <node Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>0.5</value>
          </node>
          <elseNode Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>0</value>
          </elseNode>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>MineralScreeningStation</tag>
            </li>
            <li>
              <tag>MineralScannerPreciousLumpThreat</tag>
              <chance>$siteThreatChance</chance>
            </li>
          </sitePartsTags>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
          <parms>
            <hiddenSitePartsPossible>true</hiddenSitePartsPossible>
          </parms>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <isQuestTimeout>true</isQuestTimeout>
          <delayTicks>$(randInt(30,60)*60000)</delayTicks>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label TKey="LetterLabelQuestExpired">Quest expired: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestExpired">The mineral screening station has been ransacked by the others. The quest [resolvedQuestName] has expired.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_AddItemsReward">
          <items>$generatedItemStashThings</items>
          <inSignalChoiceUsed>site.MapGenerated</inSignalChoiceUsed>
        </li>

        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End">
          </node>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

  <!-- 扫描 -->
  <QuestScriptDef>
    <defName>Scan_MineralScreeningStation</defName>
    <autoAccept>true</autoAccept>
    <defaultChallengeRating>1</defaultChallengeRating>
    <isRootSpecial>true</isRootSpecial>
    <questNameRules>
      <rulesStrings>
        <li>questName->Mineral Screening Station</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->[worker_definite] has used scanners to locate an ancient screening station whose buildings are badly damaged, but there are still a lot of recoverable resources, and because the automatic defense system is still in operation, it somehow does not recognize us as enemies, so it can be determined that there is no threat to the site.
            \n\nIt's only a matter of time before the sifting station is ransacked by other factions, and before that we still have [timeoutTicks_duration].</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_ViolentQuestsAllowed">
          <node Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>0.5</value>
          </node>
          <elseNode Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>0</value>
          </elseNode>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>MineralScreeningStation</tag>
            </li>
            <li>
              <tag>MineralScannerPreciousLumpThreat</tag>
              <chance>$siteThreatChance</chance>
            </li>
          </sitePartsTags>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <delayTicks>$(randInt(30,60)*60000)</delayTicks>
          <isQuestTimeout>true</isQuestTimeout>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label TKey="LetterLabelQuestExpired">Quest expired: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestExpired">The mineral screening station has been ransacked by the others.The quest [resolvedQuestName] has expired.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End" />
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

 <!-- 废弃矿坑 -->

  <!-- 自然刷新 -->
  <QuestScriptDef>
    <defName>AbandonedMine</defName>
    <autoAccept>true</autoAccept>
    <rootSelectionWeight>1.5</rootSelectionWeight>
    <defaultChallengeRating>1</defaultChallengeRating>
    <isRootSpecial>true</isRootSpecial>
    <questNameRules>
      <rulesStrings>
        <li>questName->Abandoned Mine</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->We heard rumors that there was a small abandoned mine pit nearby that might contain many untapped minerals.  It has been mentioned that there may be some threats, although this is uncertain.  We need to be well prepared before we go there for an adventure.  After all, there is some truth to rumors.  While we may not be the first to discover this mine pit, we still have a chance to be the first to develop it.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_ViolentQuestsAllowed">
          <node Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>0.5</value>
          </node>
          <elseNode Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>0</value>
          </elseNode>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>AbandonedMine</tag>
            </li>
            <li>
              <tag>MineralScannerPreciousLumpThreat</tag>
              <chance>$siteThreatChance</chance>
            </li>
          </sitePartsTags>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <delayTicks>$(randInt(30,60)*60000)</delayTicks>
          <isQuestTimeout>true</isQuestTimeout>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label TKey="LetterLabelQuestExpired">Quest expired: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestExpired">The place has been ransacked by others. There's nothing left. The quest [resolvedQuestName] has expired.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End" />
        </li>
      </nodes>
    </root>
  </QuestScriptDef>
  
  <!-- 扫描 -->
  <QuestScriptDef>
    <defName>Scan_AbandonedMine</defName>
    <autoAccept>true</autoAccept>
    <defaultChallengeRating>1</defaultChallengeRating>
    <isRootSpecial>true</isRootSpecial>
    <questNameRules>
      <rulesStrings>
        <li>questName->Abandoned Mine</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->The scan revealed a small mine pit nearby. However, the scanner did not provide information on the minerals present.   We have received information suggesting the presence of numerous minerals inside, and the scanner also indicated a potential threat to the location.   If we intend to obtain these minerals, we must be prepared.\n\nSooner or later, others will notice this mineral deposit, and time is of the essence.   We must act swiftly.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_ViolentQuestsAllowed">
          <node Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>0.5</value>
          </node>
          <elseNode Class="QuestNode_Set">
            <name>siteThreatChance</name>
            <value>0</value>
          </elseNode>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>AbandonedMine</tag>
            </li>
            <li>
              <tag>MineralScannerPreciousLumpThreat</tag>
              <chance>$siteThreatChance</chance>
            </li>
          </sitePartsTags>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>
        
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <delayTicks>$(randInt(30,60)*60000)</delayTicks>
          <isQuestTimeout>true</isQuestTimeout>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label TKey="LetterLabelQuestExpired">Quest expired: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestExpired">The place has been ransacked by others. There's nothing left. The quest [resolvedQuestName] has expired.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End" />
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

</Defs>